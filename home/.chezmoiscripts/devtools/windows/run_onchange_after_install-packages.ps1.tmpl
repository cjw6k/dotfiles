# ~/.config/dotfiles/utils.json hash:
# {{ include "private_dot_config/dotfiles/utils.json" | sha256sum }}

$skipInstall = @("#builtin", "#custom", "#na")

$utils = Get-Content '~/.config/dotfiles/utils.json' `
  | ConvertFrom-Json `
  | Where-Object {$_.devtools -eq $true}

$toInstall = @()
foreach ($util in $utils) {
  $name = $util.install.windows ?? $util.install.common ?? $util.name
  if ($name -in $skipInstall) {
    continue
  }

  $toInstall += $name
}

scoop install @toInstall

$pipUtils = Get-Content '~/.config/dotfiles/utils.json' `
  | ConvertFrom-Json `
  | Where-Object {$_.devtools_pip -eq $true}

$toInstallWithPip = @()
foreach ($pipUtil in $pipUtils) {
  $name = $pipUtil.install.windows ?? $pipUtil.install.common ?? $pipUtil.name
  if ($name -in $skipInstall) {
    continue
  }

  $toInstallWithPip += $name
}

pip install @toInstallWithPip
