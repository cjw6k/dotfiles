#!/usr/bin/env sh

# ~/.config/dotfiles/utils.json hash:
# {{ include "private_dot_config/dotfiles/utils.json" | sha256sum }}

read -r -d '' script << 'JQ'
.[]
  | select(.devtools == true)
  | .install.linux.alpine."{{ trimPrefix "Alpine Linux " .chezmoi.osRelease.prettyName | trimPrefix "v" | regexFind "\\d+\\.\\d+|\\w+" }}"
    // .install.linux.alpine.common
    // .install.linux.common
    // .install.common
    // .name
  | select(. as $in | ["#builtin", "#custom", "#na", "#pip"] | index($in) | not)
JQ

echo "$script"

sudo apk add $(jq -r "$script" ~/.config/dotfiles/utils.json)

read -r -d '' pipScript << 'JQ'
.[]
  | select(.devtools == true)
  | .install.linux.alpine."{{ trimPrefix "Alpine Linux " .chezmoi.osRelease.prettyName | trimPrefix "v" | regexFind "\\d+\\.\\d+|\\w+" }}"
    // .install.linux.alpine.common
    // .install.linux.common
    // .install.common
    // .name
  | select(. == "#pip")
JQ

echo "$pipScript"

pip install $(jq -r "$pipScript" ~/.config/dotfiles/utils.json)
