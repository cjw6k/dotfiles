version: '3'

vars:
  TAG:
    sh: echo ${TAG:-sphinx}

tasks:
  default:
    desc: Build the docs
    cmds:
      - task: build-sphinx
      - docker run --rm -v ./docs/:/opt/docs dotfiles:sphinx

  build: docker build -f ./.github/docs.Dockerfile . -t dotfiles:{{.TAG}} {{.CLI_ARGS}}

  build-sphinx:
    internal: true
    status:
      - docker image inspect dotfiles:sphinx > /dev/null 2>&1
    sources:
      - ./.github/docs.Dockerfile
    cmds:
      - docker build -f ./.github/docs.Dockerfile . -t dotfiles:sphinx

  clean:
    desc: Build the docs from a clean start
    cmds:
      - task: build-sphinx
      - docker run --rm -v ./docs/:/opt/docs dotfiles:sphinx sphinx-build --fresh-env --builder html source _build
